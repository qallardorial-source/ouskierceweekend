<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Station de ski - O√π skier ce weekend</title>

    <!-- SEO Meta Tags -->
    <meta name="description" id="metaDescription" content="D√©couvrez la station de ski avec tarifs, m√©t√©o en temps r√©el, dates d'ouverture et toutes les informations pratiques.">
    <meta name="keywords" id="metaKeywords" content="station ski, forfait ski, tarifs ski, m√©t√©o ski, alpes">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" id="ogTitle" content="Station de ski">
    <meta property="og:description" id="ogDescription" content="D√©couvrez cette station de ski">
    <meta property="og:image" id="ogImage" content="">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" id="twitterTitle" content="Station de ski">
    <meta property="twitter:description" id="twitterDescription" content="D√©couvrez cette station de ski">

    <!-- Schema.org structured data -->
    <script type="application/ld+json" id="schemaData"></script>

    <link rel="stylesheet" href="design-tokens.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Station Detail V2 - Version √âpur√©e */

        .station-hero {
            position: relative;
            height: 500px;
            overflow: hidden;
            border-radius: 0 0 30px 30px;
        }

        .station-hero img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(0.8);
        }

        .station-hero-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            padding: 50px;
        }

        .station-hero-overlay h1 {
            font-size: 4em;
            margin: 0 0 10px 0;
            font-weight: 800;
        }

        .hero-meta {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .hero-meta span {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .level-badge-hero {
            background: rgba(79, 172, 254, 0.3);
            padding: 8px 20px;
            border-radius: 20px;
            border: 1px solid rgba(79, 172, 254, 0.5);
        }

        /* Bouton Favori Hero */
        .favorite-btn-hero {
            position: absolute;
            top: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.95);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 2em;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s;
            z-index: 10;
        }

        .favorite-btn-hero:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        /* Quick Facts Cards */
        .quick-facts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: -60px 50px 40px;
            position: relative;
            z-index: 5;
        }

        .fact-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s;
        }

        .fact-card:hover {
            transform: translateY(-5px);
            border-color: #4facfe;
            box-shadow: 0 10px 30px rgba(79, 172, 254, 0.3);
        }

        .fact-icon {
            font-size: 3em;
            display: block;
            margin-bottom: 10px;
        }

        .fact-value {
            font-size: 2.5em;
            font-weight: 800;
            background: linear-gradient(135deg, #4facfe 0%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: block;
            margin-bottom: 5px;
        }

        .fact-label {
            font-size: 0.95em;
            opacity: 0.8;
        }

        /* CTA Primaires */
        .cta-primary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .cta-btn {
            padding: 25px 40px;
            font-size: 1.3em;
            font-weight: 700;
            border-radius: 15px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .cta-btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #f093fb 100%);
            color: white;
            box-shadow: 0 10px 30px rgba(79, 172, 254, 0.4);
        }

        .cta-btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(79, 172, 254, 0.5);
        }

        .cta-btn-secondary {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 2px solid rgba(79, 172, 254, 0.5);
        }

        .cta-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: #4facfe;
        }

        /* Tabs System */
        .tabs-container {
            margin: 50px 0;
        }

        .tabs-nav {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 30px;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .tabs-nav::-webkit-scrollbar {
            display: none;
        }

        .tab-btn {
            padding: 15px 30px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .tab-btn:hover {
            color: white;
            background: rgba(255, 255, 255, 0.05);
        }

        .tab-btn.active {
            color: #4facfe;
            border-bottom-color: #4facfe;
            background: rgba(79, 172, 254, 0.1);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Content Sections */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            border-left: 4px solid #4facfe;
        }

        .info-card h3 {
            color: #4facfe;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .info-card p {
            line-height: 1.8;
            margin: 10px 0;
        }

        .advantages-list {
            list-style: none;
            padding: 0;
        }

        .advantages-list li {
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .advantages-list li:before {
            content: "‚úì";
            color: #2ecc71;
            font-weight: bold;
            font-size: 1.3em;
        }

        /* Budget Cards */
        .budget-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .budget-card {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.2) 0%, rgba(240, 147, 251, 0.2) 100%);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid rgba(79, 172, 254, 0.3);
        }

        .budget-card h4 {
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .budget-amount {
            font-size: 3.5em;
            font-weight: 800;
            background: linear-gradient(135deg, #4facfe 0%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: block;
            margin: 15px 0;
        }

        .budget-detail {
            font-size: 0.95em;
            opacity: 0.8;
        }

        /* Stations Similaires */
        .similar-stations {
            margin: 60px 0;
        }

        .similar-stations h2 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 40px;
            color: #4facfe;
        }

        .stations-carousel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }

        .similar-card {
            background: rgba(255, 255, 255, 0.12);
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.3s;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .similar-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(79, 172, 254, 0.3);
            border-color: #4facfe;
        }

        .similar-card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .similar-card-content {
            padding: 20px;
        }

        .similar-card h3 {
            font-size: 1.4em;
            margin-bottom: 10px;
        }

        .similar-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 10px;
        }

        /* Weather Widget */
        .weather-widget {
            background: rgba(79, 172, 254, 0.15);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(79, 172, 254, 0.3);
        }

        .weather-main {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .weather-icon {
            font-size: 4em;
        }

        .weather-temp {
            font-size: 3.5em;
            font-weight: 800;
        }

        .weather-details {
            display: grid;
            gap: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .station-hero {
                height: 350px;
            }

            .station-hero-overlay {
                padding: 30px 20px;
            }

            .station-hero-overlay h1 {
                font-size: 2.5em;
            }

            .quick-facts {
                margin: -40px 20px 30px;
                grid-template-columns: repeat(2, 1fr);
            }

            .fact-value {
                font-size: 2em;
            }

            .tabs-nav {
                flex-wrap: nowrap;
            }

            .tab-btn {
                font-size: 0.95em;
                padding: 12px 20px;
            }

            .content-grid {
                grid-template-columns: 1fr;
            }

            .favorite-btn-hero {
                width: 50px;
                height: 50px;
                font-size: 1.5em;
                top: 20px;
                right: 20px;
            }
        }

        /* Tags */
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 20px 0;
        }

        .tag {
            background: rgba(79, 172, 254, 0.2);
            color: #4facfe;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.95em;
            font-weight: 600;
            border: 1px solid rgba(79, 172, 254, 0.3);
        }

        /* Alert Note */
        .alert-note {
            background: rgba(33, 150, 243, 0.15);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #2196F3;
            margin: 25px 0;
        }

        .alert-note strong {
            color: #4facfe;
        }
    </style>
</head>
<body>
    <nav class="navbar" role="navigation" aria-label="Navigation principale">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">‚õ∑Ô∏è O√π skier ce weekend</a>
            <div class="nav-menu">
                <a href="index.html" class="nav-link">Recherche</a>
                <a href="stations.html" class="nav-link">Toutes les stations</a>
                <a href="villes/" class="nav-link">Villes</a>
                <a href="blog/index.html" class="nav-link">Blog</a>
                <a href="favorites.html" class="nav-link">
                    Favoris <span class="favorites-counter">0</span>
                </a>
                <a href="about.html" class="nav-link">√Ä propos</a>
            </div>
        </div>
    </nav>

    <div class="container" role="main">
        <div id="stationDetail"></div>
    </div>

    <footer class="footer" role="contentinfo">
        <p>&copy; 2025 O√π skier ce weekend - Toutes les informations sont √† titre indicatif - <a href="legal.html" style="color: white; text-decoration: underline;">Mentions l√©gales</a></p>
    </footer>

    <script src="config.js"></script>
    <script src="stations-data.js"></script>
    <script src="favorites.js"></script>
    <script src="weather.js"></script>
    <script src="navigation.js"></script>

    <script>
        /**
         * Station Detail V2 - Version √âpur√©e avec Tabs
         */

        // Fonction pour valider l'ID de station
        function validateStationId(id) {
            if (!id || typeof id !== 'string') return null;
            const cleanId = id.trim().toLowerCase().replace(/[^a-z0-9-]/g, '');
            return (cleanId.length >= 3 && cleanId.length <= 50) ? cleanId : null;
        }

        // Charger les d√©tails de la station
        async function loadStationDetail() {
            const urlParams = new URLSearchParams(window.location.search);
            const stationId = validateStationId(urlParams.get('id'));

            if (!stationId) {
                showError('‚ö†Ô∏è Param√®tre invalide', 'L\'identifiant de la station n\'est pas valide.');
                return;
            }

            const station = skiResorts.find(s => s.id === stationId);

            if (!station) {
                showError('üîç Station introuvable', 'Aucune station ne correspond √† cet identifiant.');
                return;
            }

            // Mettre √† jour le SEO
            updateSEO(station);

            // Charger la m√©t√©o
            const weather = await getWeather(station.lat, station.lon);

            // G√©n√©rer le HTML
            const html = generateStationHTML(station, weather);
            document.getElementById('stationDetail').innerHTML = html;

            // Initialiser les tabs
            initTabs();

            // Charger les stations similaires
            loadSimilarStations(station);
        }

        // Afficher une erreur
        function showError(title, message) {
            document.getElementById('stationDetail').innerHTML = `
                <div class="no-results">
                    <h2>${title}</h2>
                    <p>${message}</p>
                    <a href="stations.html" class="btn btn-primary">Retour aux stations</a>
                </div>
            `;
        }

        // G√©n√©rer le HTML de la station
        function generateStationHTML(station, weather) {
            const priceWeekend = (station.skiPass * 2) + (station.lodging * 2);
            const priceWeek = (station.skiPass * 6) + (station.lodging * 7);
            const isFavorite = favoritesManager && favoritesManager.isFavorite(station.id);

            return `
                <!-- Hero Section -->
                <div class="station-hero">
                    <img src="${station.image}" alt="${station.name}" fetchpriority="high">
                    <button class="favorite-btn-hero" onclick="toggleFavorite('${station.id}')"
                            title="${isFavorite ? 'Retirer des favoris' : 'Ajouter aux favoris'}">
                        ${isFavorite ? '‚ù§Ô∏è' : 'ü§ç'}
                    </button>
                    <div class="station-hero-overlay">
                        <h1>${station.name}</h1>
                        <div class="hero-meta">
                            <span>üìç ${station.region}</span>
                            <span class="level-badge-hero">${station.level}</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Facts -->
                <div class="quick-facts">
                    <div class="fact-card">
                        <span class="fact-icon">üéø</span>
                        <span class="fact-value">${station.slopes}</span>
                        <span class="fact-label">de pistes</span>
                    </div>
                    <div class="fact-card">
                        <span class="fact-icon">‚õ∞Ô∏è</span>
                        <span class="fact-value">${extractAltitude(station.altitude)}m</span>
                        <span class="fact-label">altitude max</span>
                    </div>
                    <div class="fact-card">
                        <span class="fact-icon">üí∞</span>
                        <span class="fact-value">${station.skiPass}‚Ç¨</span>
                        <span class="fact-label">forfait/jour</span>
                    </div>
                    <div class="fact-card">
                        <span class="fact-icon">üìÖ</span>
                        <span class="fact-value">${station.opening}</span>
                        <span class="fact-label">ouverture</span>
                    </div>
                </div>

                <!-- CTA Primaires -->
                <div class="cta-primary">
                    <a href="https://www.google.com/search?q=${encodeURIComponent(station.name + ' forfait ski r√©servation')}"
                       target="_blank" class="cta-btn cta-btn-primary">
                        üé´ R√©server un Forfait
                    </a>
                    <a href="https://www.booking.com/searchresults.fr.html?ss=${encodeURIComponent(station.name)}"
                       target="_blank" class="cta-btn cta-btn-secondary">
                        üè® Trouver un H√©bergement
                    </a>
                </div>

                <!-- Tabs -->
                <div class="tabs-container">
                    <div class="tabs-nav" role="tablist">
                        <button class="tab-btn active" data-tab="info" role="tab" aria-selected="true">
                            üìç Informations
                        </button>
                        <button class="tab-btn" data-tab="tarifs" role="tab" aria-selected="false">
                            üí≥ Tarifs
                        </button>
                        <button class="tab-btn" data-tab="pratique" role="tab" aria-selected="false">
                            üöó Pratique
                        </button>
                        <button class="tab-btn" data-tab="meteo" role="tab" aria-selected="false">
                            üå§Ô∏è M√©t√©o
                        </button>
                    </div>

                    <!-- Tab: Informations -->
                    <div class="tab-content active" id="tab-info" role="tabpanel">
                        <p style="font-size: 1.15em; line-height: 1.8; margin-bottom: 30px;">
                            ${station.description}
                        </p>

                        <h3 style="color: #4facfe; font-size: 1.8em; margin: 30px 0 20px;">‚≠ê Points Forts</h3>
                        <ul class="advantages-list">
                            ${station.advantages.slice(0, 5).map(adv => `<li>${adv}</li>`).join('')}
                        </ul>

                        <h3 style="color: #4facfe; font-size: 1.8em; margin: 40px 0 20px;">üèîÔ∏è Domaine Skiable</h3>
                        <div class="content-grid">
                            <div class="info-card">
                                <h3>√âtendue</h3>
                                <p><strong>${station.slopes}</strong> de pistes</p>
                                <p>Altitude max : <strong>${station.altitude}</strong></p>
                            </div>
                            <div class="info-card">
                                <h3>Niveau</h3>
                                <p><strong>${station.level}</strong></p>
                                <p>${getLevelDescription(station.level)}</p>
                            </div>
                            <div class="info-card">
                                <h3>Saison</h3>
                                <p>Ouverture : <strong>${station.opening}</strong></p>
                                <p>Fermeture : <strong>${station.closing}</strong></p>
                            </div>
                        </div>

                        ${station.activities && station.activities.length > 0 ? `
                            <h3 style="color: #4facfe; font-size: 1.8em; margin: 40px 0 20px;">üéø Activit√©s</h3>
                            <div class="tags-container">
                                ${station.activities.map(act => `<span class="tag">${act}</span>`).join('')}
                            </div>
                        ` : ''}

                        ${station.equipment && station.equipment.length > 0 ? `
                            <h3 style="color: #4facfe; font-size: 1.8em; margin: 40px 0 20px;">üè¢ √âquipements</h3>
                            <div class="tags-container">
                                ${station.equipment.map(eq => `<span class="tag">${eq}</span>`).join('')}
                            </div>
                        ` : ''}
                    </div>

                    <!-- Tab: Tarifs -->
                    <div class="tab-content" id="tab-tarifs" role="tabpanel">
                        <h3 style="color: #4facfe; font-size: 1.8em; margin-bottom: 20px;">üí≥ Budget Estim√©</h3>

                        <div class="budget-cards">
                            <div class="budget-card">
                                <h4>üéø Week-end (2 jours)</h4>
                                <span class="budget-amount">${priceWeekend}‚Ç¨</span>
                                <div class="budget-detail">
                                    Forfait 2 jours : ${station.skiPass * 2}‚Ç¨<br>
                                    Logement 2 nuits : ${station.lodging * 2}‚Ç¨
                                </div>
                            </div>
                            <div class="budget-card">
                                <h4>üìÖ Semaine (6 jours ski)</h4>
                                <span class="budget-amount">${priceWeek}‚Ç¨</span>
                                <div class="budget-detail">
                                    Forfait 6 jours : ${station.skiPass * 6}‚Ç¨<br>
                                    Logement 7 nuits : ${station.lodging * 7}‚Ç¨
                                </div>
                            </div>
                        </div>

                        <div class="alert-note">
                            <strong>üí° Bon √† savoir :</strong> Ces tarifs sont donn√©s √† titre indicatif.
                            Les prix peuvent varier selon la p√©riode (haute saison, vacances scolaires)
                            et les promotions en cours.
                        </div>

                        <div class="content-grid" style="margin-top: 40px;">
                            <div class="info-card">
                                <h3>Forfait Ski</h3>
                                <p>Journ√©e adulte : <strong>${station.skiPass}‚Ç¨</strong></p>
                                <p>6 jours estim√© : <strong>${station.skiPass * 6}‚Ç¨</strong></p>
                            </div>
                            <div class="info-card">
                                <h3>H√©bergement</h3>
                                <p>Prix moyen/nuit : <strong>${station.lodging}‚Ç¨</strong></p>
                                <p>Semaine (7 nuits) : <strong>${station.lodging * 7}‚Ç¨</strong></p>
                            </div>
                        </div>
                    </div>

                    <!-- Tab: Pratique -->
                    <div class="tab-content" id="tab-pratique" role="tabpanel">
                        <h3 style="color: #4facfe; font-size: 1.8em; margin-bottom: 20px;">üöó Comment y acc√©der</h3>

                        <div class="content-grid">
                            <div class="info-card">
                                <h3>üöó En Voiture</h3>
                                <p>Depuis Lyon : ~${getDistanceFromLyon(station)}km</p>
                                <p>Depuis Grenoble : ~${getDistanceFromGrenoble(station)}km</p>
                                <p>Parking disponible en station</p>
                            </div>
                            <div class="info-card">
                                <h3>üöÜ En Train</h3>
                                <p>Gares proches :</p>
                                <p><strong>${getNearestTrainStations(station.region)}</strong></p>
                                <p>Navettes disponibles</p>
                            </div>
                            <div class="info-card">
                                <h3>‚úàÔ∏è En Avion</h3>
                                <p>A√©roports proches :</p>
                                <p><strong>${getNearestAirports(station.region)}</strong></p>
                                <p>Location de voiture possible</p>
                            </div>
                        </div>

                        <h3 style="color: #4facfe; font-size: 1.8em; margin: 40px 0 20px;">üí° Conseils Pratiques</h3>
                        <div class="content-grid">
                            <div class="info-card">
                                <h3>üéø D√©butants</h3>
                                <p>${getBeginnerAdvice(station.level)}</p>
                            </div>
                            <div class="info-card">
                                <h3>üìÖ Meilleure P√©riode</h3>
                                <p>${getBestPeriod(station.region)}</p>
                            </div>
                            <div class="info-card">
                                <h3>üéí √Ä Pr√©voir</h3>
                                <p>√âquipement de ski, v√™tements chauds, cr√®me solaire, lunettes de ski</p>
                            </div>
                        </div>
                    </div>

                    <!-- Tab: M√©t√©o -->
                    <div class="tab-content" id="tab-meteo" role="tabpanel">
                        <h3 style="color: #4facfe; font-size: 1.8em; margin-bottom: 20px;">üå§Ô∏è Conditions Actuelles</h3>

                        <div id="weatherWidget"></div>

                        <div class="alert-note" style="margin-top: 30px;">
                            <strong>üì± Astuce :</strong> T√©l√©chargez l'application officielle de ${station.name}
                            pour suivre l'√©tat des pistes et les conditions d'enneigement en temps r√©el.
                        </div>
                    </div>
                </div>

                <!-- Stations Similaires -->
                <div class="similar-stations">
                    <h2>üîÑ Stations Similaires</h2>
                    <div id="similarStationsContainer" class="stations-carousel"></div>
                </div>
            `;
        }

        // Initialiser le syst√®me de tabs
        function initTabs() {
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.getAttribute('data-tab');

                    // D√©sactiver tous les tabs
                    tabButtons.forEach(btn => {
                        btn.classList.remove('active');
                        btn.setAttribute('aria-selected', 'false');
                    });
                    tabContents.forEach(content => content.classList.remove('active'));

                    // Activer le tab cliqu√©
                    button.classList.add('active');
                    button.setAttribute('aria-selected', 'true');
                    document.getElementById(`tab-${targetTab}`).classList.add('active');
                });
            });
        }

        // Charger les stations similaires
        function loadSimilarStations(currentStation) {
            const similar = skiResorts
                .filter(s => s.id !== currentStation.id)
                .filter(s => s.region === currentStation.region ||
                            Math.abs(s.skiPass - currentStation.skiPass) <= 15)
                .slice(0, 3);

            const html = similar.map(station => `
                <div class="similar-card" onclick="window.location.href='station-detail.html?id=${station.id}'">
                    <img src="${station.image}" alt="${station.name}">
                    <div class="similar-card-content">
                        <h3>${station.name}</h3>
                        <p style="opacity: 0.8; font-size: 0.95em;">${station.region}</p>
                        <div class="similar-meta">
                            <span>üéø ${station.slopes}</span>
                            <span>üí∞ ${station.skiPass}‚Ç¨/j</span>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('similarStationsContainer').innerHTML = html;
        }

        // Toggle Favori
        function toggleFavorite(stationId) {
            if (!favoritesManager) return;

            const isFav = favoritesManager.toggleFavorite(stationId);
            const btn = document.querySelector('.favorite-btn-hero');
            if (btn) {
                btn.textContent = isFav ? '‚ù§Ô∏è' : 'ü§ç';
                btn.title = isFav ? 'Retirer des favoris' : 'Ajouter aux favoris';
            }
        }

        // Fonctions utilitaires
        function extractAltitude(altStr) {
            const match = altStr.match(/(\d+)/);
            return match ? match[1] : altStr;
        }

        function getLevelDescription(level) {
            const descriptions = {
                "D√©butant": "Parfait pour apprendre, nombreuses pistes vertes",
                "D√©butant / Interm√©diaire": "Id√©al pour progresser en famille",
                "Interm√©diaire": "Pour skieurs confirm√©s",
                "Interm√©diaire / Expert": "Terrain technique et vari√©",
                "Expert": "Pistes noires et hors-piste",
                "Tous niveaux": "Convient √† tous les skieurs"
            };
            return descriptions[level] || "Station adapt√©e √† tous";
        }

        function getDistanceFromLyon(station) {
            const lyonCoords = {lat: 45.764, lon: 4.8357};
            return Math.round(calculateDistance(lyonCoords.lat, lyonCoords.lon, station.lat, station.lon));
        }

        function getDistanceFromGrenoble(station) {
            const grenobleCoords = {lat: 45.1885, lon: 5.7245};
            return Math.round(calculateDistance(grenobleCoords.lat, grenobleCoords.lon, station.lat, station.lon));
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function getNearestTrainStations(region) {
            const stations = {
                "Alpes du Nord": "Chamb√©ry, Annecy, Grenoble",
                "Alpes du Sud": "Gap, Brian√ßon, Grenoble",
                "Pyr√©n√©es": "Pau, Lourdes, Toulouse",
                "Jura": "Besan√ßon, Pontarlier",
                "Vosges": "Strasbourg, Mulhouse",
                "Massif Central": "Clermont-Ferrand"
            };
            return stations[region] || "Consulter horaires SNCF";
        }

        function getNearestAirports(region) {
            const airports = {
                "Alpes du Nord": "Gen√®ve, Lyon, Chamb√©ry",
                "Alpes du Sud": "Marseille, Nice",
                "Pyr√©n√©es": "Toulouse, Pau",
                "Jura": "Gen√®ve, Lyon",
                "Vosges": "Strasbourg",
                "Massif Central": "Clermont-Ferrand, Lyon"
            };
            return airports[region] || "Consulter vols disponibles";
        }

        function getBeginnerAdvice(level) {
            if (level.includes("D√©butant")) {
                return "Excellente station pour d√©buter ! Nombreuses pistes vertes et √©coles de ski.";
            } else if (level.includes("Tous niveaux")) {
                return "Quelques pistes adapt√©es aux d√©butants, cours disponibles.";
            }
            return "Station plut√¥t technique. Un bon niveau est recommand√©.";
        }

        function getBestPeriod(region) {
            if (region.includes("Alpes")) {
                return "Janvier √† mars pour un enneigement optimal.";
            } else if (region.includes("Pyr√©n√©es")) {
                return "Janvier √† fin mars, conditions excellentes en f√©vrier.";
            }
            return "D√©cembre √† mars selon l'enneigement";
        }

        function updateSEO(station) {
            const title = `${station.name} - Station de ski ${station.region} | Forfait ${station.skiPass}‚Ç¨`;
            document.title = title;
            document.getElementById('pageTitle').textContent = title;

            const description = `${station.name} : ${station.slopes} de pistes, forfait √† ${station.skiPass}‚Ç¨/jour. ${station.description.substring(0, 100)}...`;
            document.getElementById('metaDescription').setAttribute('content', description);
            document.getElementById('ogTitle').setAttribute('content', title);
            document.getElementById('ogDescription').setAttribute('content', description);
            document.getElementById('ogImage').setAttribute('content', station.image);
        }

        // Charger la m√©t√©o dans le widget
        async function loadWeatherWidget() {
            const urlParams = new URLSearchParams(window.location.search);
            const stationId = validateStationId(urlParams.get('id'));
            if (!stationId) return;

            const station = skiResorts.find(s => s.id === stationId);
            if (!station) return;

            const weather = await getWeather(station.lat, station.lon);
            const weatherHTML = createWeatherHTML(weather);

            const widget = document.getElementById('weatherWidget');
            if (widget) {
                widget.innerHTML = weatherHTML;
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            loadStationDetail();

            // Charger la m√©t√©o apr√®s un court d√©lai
            setTimeout(loadWeatherWidget, 500);
        });
    </script>
</body>
</html>
